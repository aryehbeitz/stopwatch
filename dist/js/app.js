"use strict";var app=angular.module("stopwatch",[]);app.controller("userCtrl",["$scope","$timeout",function(t,a){function e(){for(var t=c.ourData.laps.length-1;t>0;t--)c.ourData.laps[t].title=c.ourData.laps[t-1].title,c.ourData.laps[t].time=c.ourData.laps[t-1].time;c.ourData.laps[0].title="...",c.ourData.laps[0].time="00:00.00"}function o(){c.mins="00",c.secs="00",c.milliSecs="00",c.startStopText="Start",c.ourData=m,s()}function r(){localStorage.stopWatchData=JSON.stringify(c.ourData)}function s(){"undefined"==typeof localStorage.stopWatchData?(localStorage.stopWatchData=JSON.stringify(c.ourData),c.lapResetText="Lap"):(c.ourData=JSON.parse(localStorage.stopWatchData),c.lapResetText="Clear",c.ourData.running&&(c.lapResetText="Lap"),c.ourData.running===!0?(c.lapResetText="Lap",n()):(0!=c.ourData.startTime?c.startStopText="Continue":c.startStopText="Start",i()))}function i(){var e;e=1==c.ourData.running?Date.now():c.ourData.stopTime;var o=e-c.ourData.startTime,r=Math.floor(o/6e4%60),s=Math.floor(o/1e3%60),i=Math.floor(o%1e3);c.mins=r>=10?r:"0"+r,c.secs=s>=10?s:"0"+s,i=i>=100?i.toString().substring(0,2):i,c.milliSecs=i>=10?i:"0"+i,a(function(){t.$digest()})}function n(){c.lapResetText="Lap",c.startStopText="Stop",c.interval=setInterval(function(){i()},55)}function l(){1==c.ourData.running?(c.pushPop(),c.ourData.laps[0].name="...",c.ourData.laps[0].time=c.mins+":"+c.secs+"."+c.milliSecs):(c.secs="00",c.mins="00",c.millisecs="00",c.ourData=angular.copy(m),c.startStopText="Start",c.lapResetText="Lap",i()),r()}function u(t){for(var a=c.ourData.laps.length,e=t;a-1>e;)c.ourData.laps[e].time=c.ourData.laps[e+1].time,c.ourData.laps[e].title=c.ourData.laps[e+1].title,e++;c.ourData.laps[a-1].time="",c.ourData.laps[a-1].title="",r()}function p(){if(1==c.ourData.running)c.ourData.running=!1,t.$emit("stopTimer"),c.startStopText="Continue",r();else{if(c.ourData.running=!0,0==c.ourData.startTime)c.ourData.startTime=Date.now();else{var a=c.ourData.stopTime-c.ourData.startTime;c.ourData.stopTime=0,c.ourData.startTime=Date.now()-a}r(),n()}}function D(t,a){if("enter"==a)c.eventsStack.push(t),c.ourData.laps[t].showInput=!0;else if("leave"==a){for(var e=0;e<c.eventsStack.length;e++)c.ourData.laps[c.eventsStack[e]].showInput=!1;c.eventsStack=[]}r()}var c=this;c.startStop=p,c.lapReset=l,c.removeLap=u,c.editDescription=D,c.pushPop=e,c.eventsStack=[];var m={startTime:0,stopTime:0,running:!1,laps:[{title:"",time:""},{title:"",time:""},{title:"",time:""},{title:"",time:""},{title:"",time:""}]};o(),t.$on("stopTimer",function(){clearInterval(c.interval),c.lapResetText="Clear",c.startStopText="Start",c.ourData.stopTime=Date.now(),i(),r()})}]);